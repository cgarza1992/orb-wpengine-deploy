version: 2.1
description: |
   A sample CircleCI config to deploy to WP Engine.
orbs:
    wpengine: jayhill90/wpe-deploy@0.8.0
    
workflows:
    build_test_deploy:
            jobs:
                - wpengine/build
                # Deploy to development
                - wpengine/deploy_site:
                      name: deploy-development
                      environment: development
                      requires:
                          - wpengine/build
                      filters:
                          branches:
                              only: development
                # Deploy to staging
                # If regression is enabled, you must also pass the pipeline ID
                - wpengine/deploy_site:
                      name: deploy-staging
                      environment: staging
                      pipeline_id: << pipeline.id >>
                      requires:
                          - wpengine/build
                      filters:
                          branches:
                              only: staging

                # Deploy to production
                # If regression is enabled, you must also pass the pipeline ID
                - wpengine/deploy_site:
                      name: deploy-production
                      environment: production
                      pipeline_id: << pipeline.id >>
                      requires:
                          - wpengine/build
                      filters:
                          branches:
                              only:
                                  - master
                                  - production

                # Deploy any branch starting with `feat-` to a feature install
                - wpengine/deploy_site:
                      name: deploy-feature
                      environment: thenameofmyfeatureinstall
                      requires:
                          - wpengine/build
                      filters:
                          branches:
                              only:
                                  - /feat-.*/

                # Deploy to any install. Specify the install by the branch name. `deploy-INSTALLNAME`
                - wpengine/deploy_site:
                      name: deploy-site
                      environment: qa
                      requires:
                          - wpengine/build
                      filters:
                          branches:
                              only:
                                  - /deploy-.*/
